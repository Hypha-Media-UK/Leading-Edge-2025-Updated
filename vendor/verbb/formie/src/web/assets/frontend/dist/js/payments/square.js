!function(){"use strict";var e={8027:function(e,t,i){i.d(t,{q:function(){return n}});var s=i(4685),r=i(4067);class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.initialized=!1,this.$form=e.$form,this.form=this.$form.form,this.$field=e.$field,this.successClass=this.form.getClasses("success"),this.successMessageClass=this.form.getClasses("successMessage"),this.errorClass=this.form.getClasses("error"),this.errorMessageClass=this.form.getClasses("errorMessage"),this.isVisible=!1;const t=new IntersectionObserver((e=>{0==e[0].intersectionRatio?(this.isVisible=!1,this.initialized&&this.onHide()):(this.isVisible=!0,this.initialized&&this.onShow())}),{root:this.$form,rootMargin:"50px"});setTimeout((()=>{t.observe(this.$field)}),500)}eventKey(e,t){return(0,s.kK)(e,`${t}-${this.$field.getAttribute("data-field-handle")}`)}removeSuccess(){(0,s.GK)(this.$field,this.successClass);const e=this.$field.querySelector("[data-payment-success]");e&&e.remove()}addSuccess(e){(0,s.PT)(this.$field,this.successClass);const t=this.$field.querySelector("[data-field-type] > div");if(!t)return console.error("Unable to find `[data-field-type] > div` to add success message.");const i=document.createElement("div");i.textContent=e,i.setAttribute("data-payment-success",""),(0,s.PT)(i,this.successMessageClass),t.appendChild(i)}removeError(){(0,s.GK)(this.$field,this.errorClass);const e=this.$field.querySelector("[data-payment-error]");e&&e.remove()}addError(e){(0,s.PT)(this.$field,this.errorClass);const t=this.$field.querySelector("[data-field-type] > div");if(!t)return console.error("Unable to find `[data-field-type] > div` to add error message.");const i=document.createElement("div");i.textContent=e,i.setAttribute("data-payment-error",""),(0,s.PT)(i,this.errorMessageClass),t.appendChild(i),this.submitHandler&&this.submitHandler.formSubmitError()}updateInputs(e,t){const i=this.$field.querySelector(`[name*="${e}"]`);i&&(i.value=t)}getBillingData(){if(!this.billingDetails)return{};const e={};if(this.billingDetails.billingName){const t=this.getFieldValue(this.billingDetails.billingName);t&&(e.name=t)}if(this.billingDetails.billingEmail){const t=this.getFieldValue(this.billingDetails.billingEmail);t&&(e.email=t)}if(this.billingDetails.billingAddress){e.address={};const t=this.getFieldValue(`${this.billingDetails.billingAddress}[address1]`),i=this.getFieldValue(`${this.billingDetails.billingAddress}[address2]`),s=this.getFieldValue(`${this.billingDetails.billingAddress}[address3]`),r=this.getFieldValue(`${this.billingDetails.billingAddress}[city]`),n=this.getFieldValue(`${this.billingDetails.billingAddress}[zip]`),o=this.getFieldValue(`${this.billingDetails.billingAddress}[state]`),a=this.getFieldValue(`${this.billingDetails.billingAddress}[country]`);t&&(e.address.line1=t),i&&(e.address.line2=i),s&&(e.address.line3=s),r&&(e.address.city=r),n&&(e.address.postal_code=n),o&&(e.address.state=o),a&&(e.address.country=a)}new CustomEvent("modifyBillingDetails",{bubbles:!0,detail:{provider:this,billing:e}});return{billing_details:e}}getFieldValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"string";const i=(0,r.oe)(this.$form,e);return"float"===t||"int"===t||"number"===t?(0,s.Bp)(i):i}getFieldLabel(e){return(0,r.N3)(this.$form,e)}onShow(){}onHide(){}processResubmit(){this.form.config.Formie.refreshFormTokens(this.form),this.submitHandler?this.submitHandler.processSubmit(["payment"]):this.form&&this.form.processSubmit(["payment"])}}window.FormiePaymentProvider=n},4067:function(e,t,i){i.d(t,{N3:function(){return n},oe:function(){return o}});const s=function(e,t){let i=e.querySelectorAll(`[name="${t}"]`);const s=e.querySelectorAll(`[name="${t}[]"]`);return s.length&&(i=s),i},r=function(e){return`fields[${e=e.replace("{field:","").replace("{","").replace("}","").replace("]","").split("[").join("][")}]`},n=function(e,t){let i="";t=r(t);const n=s(e,t);return n&&n.forEach((e=>{const t=e.closest("[data-field-type]");if(t){const e=t.querySelector("[data-field-label]");e&&(i=e.childNodes[0].textContent?.trim()??"")}})),i},o=function(e,t){let i="";t=r(t);const n=s(e,t);return n&&n.forEach((e=>"checkbox"!==e.type&&"radio"!==e.type||e.checked?i=e.value:void 0)),i}},4685:function(e,t,i){i.d(t,{Bp:function(){return a},GK:function(){return o},Iw:function(){return r},PT:function(){return n},kK:function(){return s}});const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t||(t=Math.random().toString(36).substr(2,5)),`${e}.${t}`},r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e5;const i=Date.now(),s=function(r,n){window[e]?r(window[e]):t&&Date.now()-i>=t?n(new Error("timeout")):setTimeout(s.bind(this,r,n),30)};return new Promise(s)},n=function(e,t){e&&t&&("string"==typeof t&&(t=t.split(" ")),t.forEach((t=>{e.classList.add(t)})))},o=function(e,t){e&&t&&("string"==typeof t&&(t=t.split(" ")),t.forEach((t=>{e.classList.remove(t)})))},a=function(e){let t=e.replace(/[^\d.,-]/g,"");const i=t.includes(","),s=t.includes(".");return t=i&&s?t.replace(/\./g,"").replace(/,/,"."):i&&!s?t.replace(/,/,"."):t.replace(/,/g,""),parseFloat(t)}}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=i(4685),t=i(8027);class s extends t.q{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.$form=e.$form,this.form=this.$form.form,this.$field=e.$field,this.$input=this.$field.querySelector("[data-fui-square-button]"),this.applicationId=e.applicationId,this.locationId=e.locationId,this.environment=e.environment,this.squareScriptId="FORMIE_SQUARE_SCRIPT",this.initialized=!0}onShow(){this.initField()}onHide(){this.boundEvents=!1,this.onAfterSubmit(),this.form.removeEventListener((0,e.kK)("onFormiePaymentValidate","square")),this.form.removeEventListener((0,e.kK)("onAfterFormieSubmit","square"))}initField(){if(document.getElementById(this.squareScriptId))(0,e.Iw)("Square").then((()=>{this.renderButton()}));else{const e="sandbox"===this.environment?"https://sandbox.web.squarecdn.com/v1/square.js":"https://web.squarecdn.com/v1/square.js",t=document.createElement("script");t.id=this.squareScriptId,t.src=e,t.async=!0,t.defer=!0,t.onload=()=>{this.renderButton()},document.body.appendChild(t)}this.boundEvents||(this.form.addEventListener(this.$form,(0,e.kK)("onFormiePaymentValidate","square"),this.onValidate.bind(this)),this.form.addEventListener(this.$form,(0,e.kK)("onAfterFormieSubmit","square"),this.onAfterSubmit.bind(this)),this.boundEvents=!0)}async renderButton(){try{const e=Square.payments(this.applicationId,this.locationId);this.card=await e.card(),await this.card.attach(this.$input)}catch(e){console.error("Square setup failed:",e),this.addError("Unable to initialize payment. Please try again later.")}}async onValidate(e){if("submit"===this.form.submitAction&&!e.detail.invalid){e.preventDefault(),this.submitHandler=e.detail.submitHandler;try{const e=await this.card.tokenize();"OK"===e.status?(this.updateInputs("squarePaymentId",e.token),this.submitHandler.submitForm()):this.addError(e.errors?.[0]?.message||"Payment tokenization failed.")}catch(e){console.error("Tokenization error:",e),this.addError("Payment tokenization failed. Please try again.")}}}onAfterSubmit(e){this.updateInputs("squarePaymentId","")}}window.FormieSquare=s}()}();